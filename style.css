/* ===================== BASE ===================== */
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
          font-family:'Arial',sans-serif;
          background:linear-gradient(135deg,#001f3f,#0074D9,#7FDBFF);
          min-height:100vh;
          color:#fff;
          overflow-x:hidden;
        }
        .container {
          display:flex;
          max-width:1500px;
          margin:0 auto;
          padding:20px;
          gap:30px;
        }

        /* ===================== SIMULADOR ===================== */
        .simulator-section {
          flex:2.5;
          background:rgba(0,31,63,0.35);
          border-radius:20px;
          padding:30px;
          backdrop-filter:blur(10px);
          border:1px solid rgba(127,219,255,0.2);
          position:relative;
        }
        .simulator-stage {
          position:relative;
          width:100%;
          height:560px;
          z-index:1;
          overflow:hidden;
        }
        #waveCanvas {
          width:100%;
          height:520px;
          background:linear-gradient(180deg,
              rgba(0,26,51,0.70),
              rgba(0,61,102,0.55),
              rgba(0,102,204,0.50));
          border-radius:18px;
          box-shadow:0 10px 40px rgba(0,0,0,0.35),
                     inset 0 1px 0 rgba(255,255,255,0.1);
          border:2px solid rgba(127,219,255,0.25);
          position:relative;
          z-index:3;
          display:block;
        }

        h1 {
          text-align:center;
          margin-bottom:18px;
          font-size:2.4rem;
          background:linear-gradient(45deg,#7FDBFF,#39CCCC);
          -webkit-background-clip:text;
          -webkit-text-fill-color:transparent;
          text-shadow:0 2px 10px rgba(127,219,255,0.35);
          position:relative;
          z-index:5;
        }
        h2 {
          color:#7FDBFF;
          margin-bottom:20px;
          font-size:1.3rem;
          text-align:center;
        }

        /* ===================== FARO ===================== */
        .lighthouse-container {
          position:absolute;
          left:50%;
          bottom:40px;
          transform:translateX(-50%);
          width:170px;
          height:360px;
          pointer-events:none;
          display:flex;
          align-items:flex-end;
          z-index:8;
          opacity:0.88;
        }

        .lighthouse {
          position:relative;
          width:140px;
          height:330px;
          margin:0 auto;
          display:flex;
          align-items:flex-end;
          justify-content:center;
        }

        .lighthouse-base {
          position:absolute;
          bottom:0;
          width:150px;
          height:38px;
          background:radial-gradient(circle at 50% 30%, #1d2b38, #0c141c 70%);
          border-radius:50% 50% 0 0;
        }

        .lighthouse-tower {
          position:absolute;
          bottom:38px;
          width:72px;
          height:218px;
          background:linear-gradient(180deg,#f4f8fb 0%,#dfe7ee 55%,#c3d0db 100%);
          border-radius:12px 12px 9px 9px;
          box-shadow:0 0 0 2px rgba(255,255,255,0.28),
                     0 10px 20px rgba(0,0,0,0.35);
          overflow:hidden;
          display:flex;
          flex-direction:column;
          justify-content:space-around;
        }
        .tower-stripe { width:100%; height:22%; background:linear-gradient(90deg,#133040,#1c506c); opacity:.9; }
        .stripe2 { background:linear-gradient(90deg,#1a5678,#25749f); }
        .stripe3 { background:linear-gradient(90deg,#1c506c,#133040); }

        .lighthouse-top {
          position:absolute;
          bottom:258px;
          width:108px;
          height:102px;
          display:flex;
          flex-direction:column;
          align-items:center;
        }

        .light-room {
          position:relative;
          width:100px;
          height:58px;
          background:linear-gradient(180deg,#2d4d60,#12242e);
          border:3px solid rgba(200,235,255,0.55);
          border-radius:15px;
          box-shadow:0 0 14px rgba(150,200,230,0.5),
                     0 0 30px rgba(120,180,220,0.35);
        }

        .light-core {
          position:absolute;
          top:50%; left:50%;
          width:32px; height:32px;
          transform:translate(-50%,-50%);
          background:radial-gradient(circle,#ffffff 0%,#e6faff 40%,rgba(200,240,255,0.2) 70%);
          border-radius:50%;
          box-shadow:0 0 16px 6px rgba(200,240,255,0.75),
                     0 0 40px 16px rgba(160,210,240,0.4);
          opacity:0.92;
          transition:filter .4s ease, transform .4s ease;
        }

        .beam-wrapper {
          position:absolute;
          top:50%; left:50%;
          width:22px; height:22px;
          transform:translate(-50%,-50%);
          pointer-events:none;
        }
        .light-beam {
          position:absolute;
          left:11px;
          top:50%;
          width:700px;
          height:280px;
          transform:translateY(-50%);
          background:radial-gradient(circle at 0% 50%,
            rgba(220,245,255,0.72) 0%,
            rgba(190,230,250,0.46) 25%,
            rgba(160,210,245,0.25) 50%,
            rgba(140,195,235,0.11) 65%,
            transparent 75%);
          clip-path:polygon(0% 46%,100% 22%,100% 78%,0% 54%);
          mix-blend-mode:screen;
          filter:blur(1px);
          opacity:.28;
          transition:opacity .6s ease;
        }

        .roof {
          width:112px;
          height:24px;
          background:linear-gradient(180deg,#12242e,#081117);
          border-radius:11px 11px 7px 7px;
          margin-top:6px;
          position:relative;
          box-shadow:0 4px 9px rgba(0,0,0,0.55);
        }
        .roof::after {
          content:'';
          position:absolute;
          left:50%; top:-11px;
          width:14px; height:14px;
          background:linear-gradient(180deg,#1a5572,#0b1e27);
          border-radius:50%;
          transform:translateX(-50%);
          box-shadow:0 0 7px rgba(160,210,255,0.5);
        }
        .rocks {
          position:absolute;
          bottom:0; left:0;
          width:170px; height:55px;
          background:
            radial-gradient(circle at 30% 60%, #253746 0%, transparent 60%),
            radial-gradient(circle at 60% 70%, #2f4558 0%, transparent 65%),
            radial-gradient(circle at 80% 50%, #1a2833 0%, transparent 60%),
            radial-gradient(circle at 45% 45%, #2a3f4f 0%, transparent 65%);
          filter:blur(1px);
          opacity:.52;
        }

        /* ===================== MINI DASHBOARD ===================== */
        .mini-dashboard {
          position:absolute;
          bottom:14px;
          right:14px;
          width:230px;
          background:linear-gradient(135deg,rgba(5,25,45,0.78),rgba(10,50,80,0.72));
          border:1px solid rgba(120,200,255,0.25);
          border-radius:16px;
          padding:0 0 10px;
          z-index:10;
          backdrop-filter:blur(8px);
          box-shadow:0 4px 18px rgba(0,0,0,0.45),
                     0 0 14px rgba(90,170,230,0.15);
          font-size:12px;
          display:flex;
          flex-direction:column;
          gap:8px;
          user-select:none;
          transition:height .3s ease, opacity .3s ease, transform .25s ease;
        }
        .mini-dashboard.dragging {
          opacity:0.9;
          cursor:grabbing;
        }
        .mini-dashboard.collapsed {
          height:auto;
        }
        .mini-dashboard.custom-position {
          /* cuando se arrastra quitamos constraints iniciales */
        }

        .mini-header {
          display:flex;
          align-items:center;
          justify-content:space-between;
          gap:8px;
          padding:10px 12px 9px;
          border-bottom:1px solid rgba(140,210,255,0.2);
          cursor:grab;
          background:linear-gradient(135deg,rgba(20,80,120,0.35),rgba(10,50,80,0.4));
          border-radius:16px 16px 0 0;
        }
        .mini-header:active { cursor:grabbing; }
        .mini-title {
          font-size:12px;
          letter-spacing:1px;
          text-transform:uppercase;
          color:#8fd8ff;
          font-weight:600;
        }
        .mini-toggle {
          background:linear-gradient(135deg,#1a4863,#246f94);
          color:#d2f3ff;
          border:1px solid rgba(140,210,255,0.4);
          width:26px;
          height:26px;
          border-radius:8px;
          cursor:pointer;
          font-weight:700;
          font-size:14px;
          line-height:1;
          display:flex;
          align-items:center;
          justify-content:center;
          transition:all .25s ease;
          box-shadow:0 0 6px rgba(70,140,190,0.4) inset;
        }
        .mini-toggle:hover {
          filter:brightness(1.15);
          box-shadow:0 0 10px rgba(100,170,220,0.55) inset;
        }

        .mini-content {
          padding:8px 14px 6px;
          display:flex;
          flex-direction:column;
          gap:12px;
          transition:max-height .35s ease, opacity .3s ease;
          max-height:600px;
          overflow:hidden;
        }
        .mini-dashboard[data-collapsed="true"] .mini-content {
          max-height:0;
          opacity:0;
          padding:0 14px;
          pointer-events:none;
        }
        .mini-dashboard[data-collapsed="true"] .mini-toggle {
          transform:rotate(180deg);
        }

        .mini-block label {
          display:block;
          font-size:11px;
          color:#7EC9EE;
          letter-spacing:.5px;
          margin-bottom:2px;
          font-weight:600;
          text-transform:uppercase;
        }
        .value-large {
          font-size:22px;
          font-weight:700;
          font-family:'Courier New',monospace;
          color:#d6f7ff;
          text-shadow:0 0 8px rgba(160,220,255,0.55);
          background:rgba(255,255,255,0.05);
          padding:6px 8px;
          border-radius:8px;
          border:1px solid rgba(140,210,255,0.18);
          text-align:right;
        }

        .mini-meter {
          position:relative;
          width:100%;
          height:26px;
          background:linear-gradient(180deg,#0b2534,#163d53);
          border:1px solid rgba(140,210,255,0.25);
          border-radius:30px;
          overflow:hidden;
          box-shadow:inset 0 0 6px rgba(0,0,0,0.5);
        }
        .mini-meter.slim { height:18px; }
        .mini-meter-fill {
          position:absolute;
          left:0; top:0;
          height:100%;
          width:0%;
          background:linear-gradient(90deg,#1d6d8f,#37b2e8,#b9f2ff);
          box-shadow:0 0 8px rgba(120,200,255,0.6);
          transition:width .6s ease;
        }
        .mini-meter-fill.alt {
          background:linear-gradient(90deg,#275b8f,#3aa7ff,#ffffff);
          box-shadow:0 0 10px rgba(150,220,255,0.65);
        }

        .mini-needle {
          position:absolute;
          top:50%;
          width:0;
          transform:translateY(-50%);
          transition:left .7s cubic-bezier(.68,-0.55,.27,1.55);
          pointer-events:none;
        }
        .mini-needle-head {
          position:absolute;
          right:-6px;
          top:50%;
          transform:translateY(-50%);
          font-size:10px;
          color:#fff;
          text-shadow:0 0 6px rgba(150,230,255,0.9);
          filter:drop-shadow(0 0 4px rgba(130,210,255,0.7));
        }

        .mini-row {
          display:flex;
          justify-content:space-between;
          align-items:center;
          font-size:11px;
          margin-top:4px;
          background:rgba(255,255,255,0.05);
          padding:4px 8px;
          border-radius:6px;
          border:1px solid rgba(140,210,255,0.15);
        }

        .tag {
          background:linear-gradient(135deg,#1a4863,#246f94);
          padding:3px 8px;
          border-radius:12px;
          font-size:11px;
          font-weight:600;
          color:#bdefff;
          letter-spacing:.5px;
          box-shadow:0 0 6px rgba(80,160,200,0.4) inset;
        }
        .tag.small { font-size:10px; }
        .mono { font-family:'Courier New',monospace; font-weight:600; color:#d4f6ff; }

        /* ===================== PANEL LATERAL ===================== */
        .controls-section {
          flex:1;
          background:rgba(0,116,217,0.2);
          border-radius:20px;
          padding:30px;
          backdrop-filter:blur(10px);
          border:1px solid rgba(127,219,255,0.3);
          height:fit-content;
          position:relative;
          z-index:10;
        }
        .control-group {
          margin-bottom:25px;
          background:rgba(0,31,63,0.45);
          padding:20px;
          border-radius:12px;
          border:1px solid rgba(127,219,255,0.15);
          transition:background .3s ease, transform .3s ease;
        }
        .control-group:hover {
          background:rgba(0,31,63,0.65);
          transform:translateY(-2px);
        }
        .control-group label {
          display:block;
          margin-bottom:8px;
          font-weight:bold;
          color:#7FDBFF;
          font-size:0.95rem;
        }
        .slider-container {
          display:flex;
          align-items:center;
          gap:15px;
        }
        .slider {
          flex:1;
          height:8px;
          border-radius:5px;
          background:linear-gradient(to right,#003d66,#0074D9);
          outline:none;
          cursor:pointer;
          transition:all .3s ease;
        }
        .slider::-webkit-slider-thumb {
          appearance:none;
          width:20px;
          height:20px;
          border-radius:50%;
          background:linear-gradient(45deg,#7FDBFF,#39CCCC);
          box-shadow:0 2px 10px rgba(127,219,255,0.5);
          transition:.3s;
          cursor:pointer;
        }
        .slider::-webkit-slider-thumb:hover {
          transform:scale(1.2);
          box-shadow:0 4px 15px rgba(127,219,255,0.8);
        }
        .value-display {
          min-width:80px;
          text-align:center;
          background:rgba(127,219,255,0.1);
          padding:8px 12px;
          border-radius:8px;
          font-weight:bold;
          color:#7FDBFF;
          border:1px solid rgba(127,219,255,0.3);
        }

        /* ===================== FORMULA / INFO ===================== */
        .formula-display {
          background:rgba(0,31,63,0.6);
          padding:20px;
          border-radius:12px;
          margin-top:25px;
          font-family:'Courier New',monospace;
          border:1px solid rgba(127,219,255,0.2);
        }
        .formula-display h4 {
          color:#7FDBFF;
          margin-bottom:10px;
          font-size:1rem;
        }
        .formula {
          color:#39CCCC;
          font-size:0.9rem;
          line-height:1.6;
        }
        .info-panel {
          background:rgba(0,31,63,0.45);
          padding:20px;
          border-radius:12px;
          margin-top:25px;
          border:1px solid rgba(127,219,255,0.15);
        }
        .info-panel h4 {
          color:#7FDBFF;
          margin-bottom:15px;
          font-size:1rem;
        }
        .info-item {
          display:flex;
          justify-content:space-between;
          margin-bottom:8px;
          font-size:0.9rem;
        }
        .info-label { color:#39CCCC; }
        .info-value { color:#7FDBFF; font-weight:bold; }

        @keyframes harpoonVibrate {
          0%,100% { transform:translateY(-50%) translateX(0); }
          25% { transform:translateY(-50%) translateX(-1px); }
          75% { transform:translateY(-50%) translateX(1px); }
        }

        /* ===================== MEDIA QUERIES RESPONSIVE ===================== */

        /* Tablets grandes - 1200px */
        @media (max-width: 1200px) {
          .container { gap: 20px; padding: 15px; }
          h1 { font-size: 2rem; }
          .simulator-section { padding: 20px; }
          .controls-section { padding: 20px; }
          .mini-dashboard { width: 200px; }
          .lighthouse-container { 
            width: 140px; 
            height: 300px; 
            bottom: 30px;
          }
          .lighthouse { 
            width: 120px; 
            height: 280px; 
          }
          .lighthouse-tower { 
            width: 60px; 
            height: 180px; 
          }
          .light-beam { 
            width: 500px; 
            height: 200px; 
          }
        }

        /* Tablets - 1000px */
        @media (max-width: 1000px) {
          .container { flex-direction: column; gap: 20px; }
          .simulator-section { flex: none; }
          .controls-section { flex: none; }
          .simulator-stage { height: 500px; }
          #waveCanvas { height: 460px; }
          .mini-dashboard { 
            width: 180px; 
            bottom: 10px;
            right: 10px;
          }
          .lighthouse-container { 
            width: 120px; 
            height: 260px; 
            bottom: 25px;
          }
          .lighthouse { 
            width: 100px; 
            height: 240px; 
          }
          .lighthouse-base { width: 120px; height: 30px; }
          .lighthouse-tower { 
            width: 50px; 
            height: 160px; 
            bottom: 30px;
          }
          .lighthouse-top { 
            width: 90px; 
            height: 80px; 
            bottom: 192px;
          }
          .light-room { 
            width: 80px; 
            height: 45px; 
          }
          .light-core { 
            width: 25px; 
            height: 25px; 
          }
          .roof { 
            width: 90px; 
            height: 18px; 
          }
          .light-beam { 
            width: 400px; 
            height: 160px; 
          }
        }

        /* Móviles grandes - 768px */
        @media (max-width: 768px) {
          .container { padding: 10px; gap: 15px; }
          h1 { font-size: 1.7rem; margin-bottom: 15px; }
          h2 { font-size: 1.1rem; }
          .simulator-section { padding: 15px; border-radius: 15px; }
          .controls-section { padding: 15px; border-radius: 15px; }
          .simulator-stage { height: 440px; }
          #waveCanvas { height: 400px; border-radius: 12px; }
          
          .control-group { 
            padding: 15px; 
            margin-bottom: 20px;
            border-radius: 10px;
          }
          .control-group label { font-size: 0.9rem; }
          .slider-container { gap: 10px; }
          .value-display { 
            min-width: 70px; 
            padding: 6px 10px;
            font-size: 0.9rem;
          }
          
          .formula-display { padding: 15px; }
          .info-panel { padding: 15px; }
          .formula { font-size: 0.8rem; }
          .info-item { font-size: 0.85rem; }
          
          .mini-dashboard { 
            width: 160px; 
            font-size: 11px;
            bottom: 8px;
            right: 8px;
          }
          .mini-header { padding: 8px 10px; }
          .mini-title { font-size: 10px; }
          .mini-toggle { width: 22px; height: 22px; font-size: 12px; }
          .value-large { font-size: 18px; padding: 5px 6px; }
          .mini-meter { height: 22px; }
          .mini-meter.slim { height: 16px; }
          .mini-row { font-size: 10px; padding: 3px 6px; }
          .tag { font-size: 10px; padding: 2px 6px; }
          .tag.small { font-size: 9px; }
          
          .lighthouse-container { 
            width: 100px; 
            height: 220px; 
            bottom: 20px;
          }
          .lighthouse { 
            width: 85px; 
            height: 200px; 
          }
          .lighthouse-base { width: 100px; height: 25px; }
          .lighthouse-tower { 
            width: 42px; 
            height: 140px; 
            bottom: 25px;
          }
          .lighthouse-top { 
            width: 75px; 
            height: 65px; 
            bottom: 167px;
          }
          .light-room { 
            width: 65px; 
            height: 38px; 
          }
          .light-core { 
            width: 20px; 
            height: 20px; 
          }
          .roof { 
            width: 75px; 
            height: 15px; 
            border-radius: 8px 8px 5px 5px;
          }
          .roof::after { 
            width: 8px; 
            height: 8px; 
            top: -6px;
          }
          .light-beam { 
            width: 200px; 
            height: 80px; 
          }
          .rocks { 
            width: 60px; 
            height: 25px; 
          }
        }

        /* Móviles muy pequeños - 320px */
        @media (max-width: 320px) {
          h1 { font-size: 1.1rem; }
          h2 { font-size: 1rem; }
          .simulator-stage { height: 280px; }
          #waveCanvas { height: 240px; }
          
          .control-group label { font-size: 0.8rem; }
          .value-display { font-size: 0.8rem; }
          .formula { font-size: 0.75rem; }
          .info-item { font-size: 0.8rem; }
          
          .mini-dashboard { 
            width: 100px;
            font-size: 9px;
          }
          .value-large { font-size: 12px; }
          .mini-meter { height: 16px; }
          .mini-row { font-size: 8px; }
          
          .lighthouse-container { 
            width: 50px; 
            height: 110px; 
            bottom: 8px;
          }
          .lighthouse { 
            width: 45px; 
            height: 100px; 
          }
          .lighthouse-base { width: 50px; height: 12px; }
          .lighthouse-tower { 
            width: 22px; 
            height: 70px; 
            bottom: 12px;
          }
          .lighthouse-top { 
            width: 35px; 
            height: 28px; 
            bottom: 84px;
          }
          .light-room { 
            width: 30px; 
            height: 18px; 
          }
          .light-core { 
            width: 10px; 
            height: 10px; 
          }
          .roof { 
            width: 35px; 
            height: 8px; 
          }
          .roof::after { 
            width: 6px; 
            height: 6px; 
            top: -4px;
          }
          .light-beam { 
            width: 150px; 
            height: 60px; 
          }
          .rocks { 
            width: 50px; 
            height: 20px; 
          }
        }

        /* Landscape móviles */
        @media (max-height: 500px) and (orientation: landscape) {
          .container { flex-direction: row; }
          .simulator-section { flex: 2; }
          .controls-section { flex: 1; max-height: 400px; overflow-y: auto; }
          .simulator-stage { height: 350px; }
          #waveCanvas { height: 310px; }
          
          .lighthouse-container { 
            width: 80px; 
            height: 160px; 
            bottom: 10px;
          }
          .lighthouse { 
            width: 70px; 
            height: 140px; 
          }
          .lighthouse-tower { 
            width: 30px; 
            height: 90px; 
          }
          .light-beam { 
            width: 200px; 
            height: 80px; 
          }
          
          .mini-dashboard { 
            width: 140px;
            bottom: 5px;
            right: 5px;
          }
          
          .control-group { margin-bottom: 15px; padding: 12px; }
          .formula-display { padding: 12px; margin-top: 15px; }
          .info-panel { padding: 12px; margin-top: 15px; }
        }

        /* Ajustes para pantallas táctiles */
        @media (hover: none) and (pointer: coarse) {
          .slider::-webkit-slider-thumb {
            width: 24px;
            height: 24px;
          }
          .mini-toggle {
            width: 28px;
            height: 28px;
            font-size: 15px;
          }
          .control-group {
            padding: 18px;
          }
          .mini-header {
            padding: 12px;
          }
        }

        /* Modo oscuro específico para dispositivos que lo soporten */
        @media (prefers-color-scheme: dark) {
          body {
            background: linear-gradient(135deg, #000814, #001d3d, #003566);
          }
          .simulator-section {
            background: rgba(0, 8, 20, 0.4);
            border-color: rgba(127, 219, 255, 0.3);
          }
          .controls-section {
            background: rgba(0, 29, 61, 0.25);
            border-color: rgba(127, 219, 255, 0.35);
          }
        }

        /* Alto contraste para accesibilidad */
        @media (prefers-contrast: high) {
          .mini-dashboard {
            border: 2px solid #7FDBFF;
            background: rgba(0, 31, 63, 0.9);
          }
          .control-group {
            border: 2px solid rgba(127, 219, 255, 0.5);
          }
          #waveCanvas {
            border: 3px solid rgba(127, 219, 255, 0.6);
          }
        }

        /* Reducir movimiento para usuarios sensibles */
        @media (prefers-reduced-motion: reduce) {
          * {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
          }
          .light-beam {
            opacity: 0.3;
          }
          .mini-needle {
            transition: none;
          }
        }